# LIC-001: Low Irradiance Conditions Test

## Overview

The LIC-001 protocol implements the Low Irradiance Conditions test according to **IEC 61215-1:2021** standard. This test evaluates photovoltaic (PV) module performance under low light conditions, which is critical for assessing real-world performance in cloudy conditions, early morning, late evening, and indoor applications.

## Standard Compliance

- **Standard**: IEC 61215-1:2021
- **Test Category**: PERFORMANCE
- **Protocol ID**: LIC-001
- **Version**: 1.0.0

## Test Objectives

1. Evaluate PV module performance at multiple low irradiance levels
2. Assess linearity of power output with irradiance
3. Measure fill factor variation at low light levels
4. Determine efficiency at various irradiance conditions
5. Ensure consistent performance across the irradiance range

## Test Conditions

### Irradiance Levels

The test is performed at **four irradiance levels**:
- 200 W/m²
- 400 W/m²
- 600 W/m²
- 800 W/m²

**Tolerance**: ±10 W/m²

### Temperature

- **Target**: 25°C
- **Tolerance**: ±2°C

### Spectrum

- **Standard**: AM1.5G (Air Mass 1.5 Global)
- **Alternative**: AM1.5D (Direct)

## Test Procedure

### 1. Sample Preparation

1. Record sample information:
   - Sample ID (unique identifier)
   - Module type/model
   - Manufacturer
   - Serial number
   - Batch ID
   - Cell technology (mono-Si, poly-Si, etc.)
   - Rated power at STC
   - Module area (m²)
   - Number of cells

2. Acclimate sample to test temperature (25°C) for sufficient time

### 2. Equipment Setup

1. Configure solar simulator for AM1.5G spectrum
2. Calibrate irradiance measurement system
3. Verify temperature control and monitoring
4. Record equipment ID and calibration status

### 3. Measurements

For each irradiance level (200, 400, 600, 800 W/m²):

1. Set simulator to target irradiance
2. Verify actual irradiance (within ±10 W/m²)
3. Verify module temperature (25°C ± 2°C)
4. Record complete I-V curve:
   - Minimum 10 points (50+ recommended)
   - From short-circuit to open-circuit
   - Monotonically increasing voltage
5. Record timestamp and measurement conditions

**Data Requirements**:
- Voltage array (V)
- Current array (A)
- Actual irradiance (W/m²)
- Actual temperature (°C)
- Voc (V) - optional verification
- Isc (A) - optional verification

### 4. Data Analysis

Automated analysis calculates for each irradiance level:

1. **Maximum Power Point (MPP)**:
   - Pmax (W) - Maximum power
   - Vmp (V) - Voltage at maximum power
   - Imp (A) - Current at maximum power

2. **Characteristic Parameters**:
   - Voc (V) - Open circuit voltage
   - Isc (A) - Short circuit current

3. **Performance Metrics**:
   - Fill Factor (FF) = Pmax / (Voc × Isc)
   - Efficiency (η) = Pmax / (Irradiance × Area) × 100%

4. **Quality Indicators**:
   - I-V curve quality assessment
   - Data quality score (0-100)

### 5. Performance Comparison

Across all irradiance levels:

1. **Linearity Analysis**:
   - R² value for Pmax vs Irradiance
   - Linear fit parameters
   - Deviation from linearity

2. **Variation Analysis**:
   - Efficiency variation statistics
   - Fill factor variation statistics
   - Performance trends

## Pass/Fail Criteria

### Data Quality Criteria

1. **I-V Curve Quality**:
   - Minimum 10 data points per curve
   - Monotonic voltage increase
   - Finite values (no NaN or Inf)
   - Quality score ≥ 70/100

2. **Measurement Accuracy**:
   - Irradiance within ±10 W/m² of target
   - Temperature within ±2°C of 25°C

### Performance Criteria

1. **Overall Test**:
   - All required irradiance levels measured
   - Average quality score ≥ 70/100
   - Valid results for all levels

2. **Linearity** (Information Only):
   - R² ≥ 0.95: Excellent linearity
   - R² ≥ 0.90: Good linearity
   - R² < 0.90: May indicate non-ideal behavior

## Data Output

### JSON Format

Complete test data is exported in JSON format following the schema:

```json
{
  "protocol_info": {
    "protocol_id": "LIC-001",
    "version": "1.0.0",
    "standard": "IEC 61215-1:2021",
    "category": "PERFORMANCE",
    "test_date": "ISO 8601 timestamp"
  },
  "sample_info": {
    "sample_id": "string",
    "module_type": "string",
    "manufacturer": "string",
    ...
  },
  "test_conditions": {
    "temperature": 25.0,
    "irradiance_levels": [200, 400, 600, 800],
    ...
  },
  "measurements": {
    "200": { "iv_curve": {...}, ... },
    "400": { "iv_curve": {...}, ... },
    "600": { "iv_curve": {...}, ... },
    "800": { "iv_curve": {...}, ... }
  },
  "results": {
    "by_irradiance": {
      "200": { "pmax": ..., "efficiency": ..., ... },
      ...
    },
    "summary": {
      "test_passed": true/false,
      "quality_score": 0-100,
      ...
    }
  },
  "metadata": {
    "run_id": "unique identifier",
    "data_hash": "SHA256 hash for traceability",
    ...
  }
}
```

### Visualizations

The following plots are automatically generated:

1. **I-V Curves** (200, 400, 600 W/m²):
   - Voltage vs Current for specified levels
   - Color-coded by irradiance
   - Interactive with hover details

2. **Power Curves**:
   - Voltage vs Power for all levels
   - Maximum power points marked
   - Color-coded by irradiance

3. **Performance Summary**:
   - Bar charts of Pmax, Fill Factor, Efficiency
   - Comparison across all irradiance levels

4. **Irradiance Response**:
   - Pmax vs Irradiance scatter plot
   - Linear fit with R² value
   - Trend analysis

5. **Fill Factor Comparison**:
   - Fill Factor vs Irradiance
   - Mean line indicator
   - Variation visualization

## Data Traceability

### SHA256 Hash

Each test run includes a SHA256 hash of the complete data package for:
- Data integrity verification
- Tamper detection
- Version tracking
- Audit trail

### Integration Points

1. **LIMS Integration**:
   - LIMS ID linkage
   - Automatic data upload
   - Bidirectional synchronization

2. **QMS Integration**:
   - QMS ID linkage
   - Quality record management
   - Compliance tracking

3. **Project Management**:
   - Project ID linkage
   - Progress tracking
   - Resource allocation

## Usage

### Python API

```python
from protocols.lic_001 import LIC001Protocol

# Initialize protocol
protocol = LIC001Protocol()

# Create test run
test_run = protocol.create_test_run(
    sample_id="SAMPLE-001",
    sample_info={
        "module_type": "Example 100W",
        "manufacturer": "Example Corp",
        "module_area": 0.65,
        ...
    },
    operator="John Doe"
)

# Add measurements for each irradiance level
test_run["measurements"]["200"] = {
    "actual_irradiance": 200.0,
    "actual_temperature": 25.0,
    "iv_curve": {
        "voltage": [...],
        "current": [...]
    }
}

# Validate inputs
is_valid, errors = protocol.validate_inputs(test_run)

# Calculate results
results = protocol.calculate_results(test_run)

# Generate visualizations
plots = protocol.generate_visualizations({
    **test_run,
    "results": results
})

# Finalize (adds hash)
final_data = protocol.finalize_test_run(test_run)

# Save results
protocol.save_results(Path("results.json"), format="json")
```

### Interactive UI

The GenSpark Streamlit interface provides:

1. **Test Setup Tab**:
   - Sample information form
   - Test conditions configuration
   - Operator and equipment details

2. **Measurements Tab**:
   - Tabbed interface for each irradiance level
   - CSV upload or manual entry
   - Real-time validation
   - Progress tracking

3. **Analysis & Results Tab**:
   - One-click analysis
   - Results tables
   - Interactive visualizations
   - Quality assessment

4. **Export Tab**:
   - JSON/CSV/TXT downloads
   - LIMS/QMS integration
   - Data package with hash

**To run the UI**:

```bash
streamlit run ui/genspark.py
```

## Quality Assurance

### Automated Validation

The protocol includes automated validation for:

1. **Input Validation**:
   - Required fields present
   - Value ranges correct
   - Format compliance

2. **Measurement Validation**:
   - I-V curve quality checks
   - Data completeness
   - Physical reasonableness

3. **Results Validation**:
   - Calculated values within expected ranges
   - Consistency checks
   - Statistical validation

### Testing

Comprehensive test suite included:

```bash
# Run all tests
pytest tests/test_lic_001.py -v

# Run with coverage
pytest tests/test_lic_001.py --cov=protocols.lic_001 --cov-report=html
```

Test coverage includes:
- Protocol initialization
- Data validation
- Results calculation
- Visualization generation
- Complete workflow integration
- Edge cases and error handling

## References

1. IEC 61215-1:2021 - Terrestrial photovoltaic (PV) modules - Design qualification and type approval - Part 1: Test requirements
2. IEC 60904-1 - Photovoltaic devices - Part 1: Measurement of photovoltaic current-voltage characteristics
3. IEC 60904-3 - Photovoltaic devices - Part 3: Measurement principles for terrestrial photovoltaic (PV) solar devices with reference spectral irradiance data

## Revision History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0.0 | 2024-01-15 | Initial release | PV Testing Team |

## Contact

For questions or support:
- GitHub Issues: [test-protocols repository]
- Email: support@pv-testing.example.com
- Documentation: https://docs.pv-testing.example.com

---

**Document Control**:
- Document ID: LIC-001-DOC-v1.0
- Classification: Technical Documentation
- Review Date: 2024-07-15
