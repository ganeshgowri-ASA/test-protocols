{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://test-protocols.example.com/protocol-schema.json",
  "title": "Test Protocol Definition Schema",
  "description": "Schema for defining modular test protocols in JSON format",
  "type": "object",
  "required": ["protocol_id", "name", "category", "version", "steps", "data_fields"],
  "properties": {
    "protocol_id": {
      "type": "string",
      "pattern": "^[A-Z]+-[0-9]{3}$",
      "description": "Unique protocol identifier (e.g., CORR-001)"
    },
    "name": {
      "type": "string",
      "description": "Human-readable protocol name"
    },
    "category": {
      "type": "string",
      "enum": ["degradation", "electrical", "mechanical", "optical", "environmental"],
      "description": "Protocol category"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "description": "Protocol version (semantic versioning)"
    },
    "description": {
      "type": "string",
      "description": "Detailed protocol description"
    },
    "standards": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "number"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Standard organization (e.g., IEC, ASTM)"
          },
          "number": {
            "type": "string",
            "description": "Standard number (e.g., 61701, B117)"
          },
          "title": {
            "type": "string",
            "description": "Standard title"
          },
          "year": {
            "type": "integer",
            "description": "Publication year"
          }
        }
      },
      "description": "Relevant testing standards"
    },
    "parameters": {
      "type": "object",
      "properties": {
        "test_conditions": {
          "type": "object",
          "description": "Environmental and test conditions"
        },
        "equipment": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "type"],
            "properties": {
              "name": {"type": "string"},
              "type": {"type": "string"},
              "model": {"type": "string"},
              "calibration_required": {"type": "boolean"}
            }
          },
          "description": "Required equipment"
        },
        "sample_requirements": {
          "type": "object",
          "properties": {
            "quantity": {"type": "integer"},
            "dimensions": {"type": "string"},
            "preparation": {"type": "string"}
          },
          "description": "Sample requirements"
        }
      },
      "description": "Test parameters and requirements"
    },
    "steps": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["step_number", "name", "type"],
        "properties": {
          "step_number": {
            "type": "integer",
            "minimum": 1,
            "description": "Step sequence number"
          },
          "name": {
            "type": "string",
            "description": "Step name"
          },
          "type": {
            "type": "string",
            "enum": ["setup", "preparation", "measurement", "conditioning", "analysis", "documentation"],
            "description": "Step type"
          },
          "description": {
            "type": "string",
            "description": "Detailed step instructions"
          },
          "duration": {
            "type": "object",
            "properties": {
              "value": {"type": "number"},
              "unit": {"type": "string", "enum": ["seconds", "minutes", "hours", "days"]}
            },
            "description": "Expected step duration"
          },
          "automated": {
            "type": "boolean",
            "description": "Whether step is automated"
          },
          "quality_checks": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Quality checks for this step"
          }
        }
      },
      "description": "Protocol execution steps"
    },
    "data_fields": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["field_id", "name", "type"],
        "properties": {
          "field_id": {
            "type": "string",
            "pattern": "^[a-z_][a-z0-9_]*$",
            "description": "Unique field identifier (snake_case)"
          },
          "name": {
            "type": "string",
            "description": "Human-readable field name"
          },
          "type": {
            "type": "string",
            "enum": ["number", "text", "date", "datetime", "boolean", "select", "multiselect", "file"],
            "description": "Data type"
          },
          "unit": {
            "type": "string",
            "description": "Measurement unit"
          },
          "required": {
            "type": "boolean",
            "default": false,
            "description": "Whether field is required"
          },
          "validation": {
            "type": "object",
            "properties": {
              "min": {"type": "number"},
              "max": {"type": "number"},
              "pattern": {"type": "string"},
              "options": {"type": "array", "items": {"type": "string"}}
            },
            "description": "Validation rules"
          },
          "description": {
            "type": "string",
            "description": "Field description/help text"
          },
          "step_number": {
            "type": "integer",
            "description": "Associated step number"
          }
        }
      },
      "description": "Data fields to collect"
    },
    "qc_criteria": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["criterion_id", "name", "type"],
        "properties": {
          "criterion_id": {
            "type": "string",
            "description": "Unique criterion identifier"
          },
          "name": {
            "type": "string",
            "description": "Criterion name"
          },
          "type": {
            "type": "string",
            "enum": ["range", "threshold", "comparison", "pattern", "statistical"],
            "description": "QC check type"
          },
          "field_id": {
            "type": "string",
            "description": "Associated data field"
          },
          "condition": {
            "type": "object",
            "description": "QC condition definition"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "warning", "info"],
            "default": "warning",
            "description": "Issue severity"
          }
        }
      },
      "description": "Quality control criteria"
    },
    "analysis": {
      "type": "object",
      "properties": {
        "calculations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "formula"],
            "properties": {
              "name": {"type": "string"},
              "formula": {"type": "string"},
              "unit": {"type": "string"},
              "description": {"type": "string"}
            }
          },
          "description": "Automated calculations"
        },
        "charts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "type"],
            "properties": {
              "name": {"type": "string"},
              "type": {"type": "string", "enum": ["line", "scatter", "bar", "heatmap", "box"]},
              "x_field": {"type": "string"},
              "y_field": {"type": "string"},
              "title": {"type": "string"}
            }
          },
          "description": "Chart definitions"
        },
        "statistical_tests": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "test_name": {"type": "string"},
              "fields": {"type": "array", "items": {"type": "string"}},
              "confidence_level": {"type": "number"}
            }
          },
          "description": "Statistical analyses"
        }
      },
      "description": "Analysis configuration"
    },
    "report_template": {
      "type": "object",
      "properties": {
        "sections": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "title": {"type": "string"},
              "content_type": {"type": "string", "enum": ["text", "table", "chart", "image"]},
              "include": {"type": "boolean"}
            }
          }
        }
      },
      "description": "Report generation template"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "author": {"type": "string"},
        "created_date": {"type": "string", "format": "date"},
        "last_modified": {"type": "string", "format": "date"},
        "tags": {"type": "array", "items": {"type": "string"}},
        "complexity": {"type": "string", "enum": ["low", "medium", "high"]},
        "typical_duration": {"type": "string"}
      },
      "description": "Protocol metadata"
    }
  }
}
